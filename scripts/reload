#!/bin/bash
# Simple reload script for dotfiles configurations

set -e

# Colors for output
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
RED='\033[0;31m'
NC='\033[0m' # No Color

log() {
    echo -e "${GREEN}[RELOAD]${NC} $1"
}

warn() {
    echo -e "${YELLOW}[WARN]${NC} $1"
}

error() {
    echo -e "${RED}[ERROR]${NC} $1" >&2
}

# Reload Hyprland
reload_hyprland() {
    if command -v hyprctl &> /dev/null; then
        log "Reloading Hyprland configuration..."
        hyprctl reload
    else
        warn "hyprctl not found, skipping Hyprland reload"
    fi
}

# Reload Waybar
reload_waybar() {
    if pgrep -x waybar > /dev/null; then
        log "Restarting Waybar..."
        pkill -x waybar
        sleep 0.5
        uwsm app -- waybar &
    else
        warn "Waybar not running, starting it..."
        uwsm app -- waybar &
    fi
}

# Reload Hyprpaper
reload_hyprpaper() {
    if pgrep -x hyprpaper > /dev/null; then
        log "Restarting Hyprpaper..."
        pkill -x hyprpaper
        sleep 0.5
        uwsm app -- hyprpaper &
    else
        warn "Hyprpaper not running, starting it..."
        uwsm app -- hyprpaper &
    fi
}

# Reload Hypridle
reload_hypridle() {
    if pgrep -x hypridle > /dev/null; then
        log "Restarting Hypridle..."
        pkill -x hypridle
        sleep 0.5
        uwsm app -- hypridle &
    else
        warn "Hypridle not running, starting it..."
        uwsm app -- hypridle &
    fi
}

# Main function
main() {
    local components=("$@")

    if [ ${#components[@]} -eq 0 ]; then
        components=(hyprland waybar hyprpaper hypridle)
    fi

    log "Reloading: ${components[*]}"

    for component in "${components[@]}"; do
        case $component in
            hyprland)
                reload_hyprland
                ;;
            waybar)
                reload_waybar
                ;;
            hyprpaper)
                reload_hyprpaper
                ;;
            hypridle)
                reload_hypridle
                ;;
            *)
                error "Unknown component: $component"
                echo "Available: hyprland, waybar, hyprpaper, hypridle"
                exit 1
                ;;
        esac
    done

    log "Reload complete!"
}

main "$@"
